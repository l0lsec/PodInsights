{% extends "base.html" %}
{% block title %}Articles | PodInsights{% endblock %}
{% block header %}Generated Articles{% endblock %}
{% block content %}
<p class="lead text-muted mb-4">Articles generated from podcast transcriptions on tech, privacy, and cybersecurity topics.</p>

<!-- Filter Bar -->
<div class="filter-bar">
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label">Search</label>
            <input type="text" class="form-control" name="q" value="{{ search_query }}" placeholder="Search topics, episodes...">
        </div>
        <div class="col-md-2">
            <label class="form-label">Style</label>
            <select name="style" class="form-select">
                <option value="">All Styles</option>
                {% for s in all_styles %}
                <option value="{{ s }}" {% if filter_style == s %}selected{% endif %}>{{ s|capitalize }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Source</label>
            <select name="podcast" class="form-select">
                <option value="">All Sources</option>
                {% for p in all_podcasts %}
                <option value="{{ p }}" {% if filter_podcast == p %}selected{% endif %}>{{ p[:25] }}{% if p|length > 25 %}...{% endif %}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Sort By</label>
            <select name="sort" class="form-select">
                <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date Created</option>
                <option value="topic" {% if sort_by == 'topic' %}selected{% endif %}>Topic</option>
                <option value="style" {% if sort_by == 'style' %}selected{% endif %}>Style</option>
                <option value="podcast" {% if sort_by == 'podcast' %}selected{% endif %}>Source</option>
            </select>
        </div>
        <div class="col-md-1">
            <label class="form-label">Order</label>
            <select name="order" class="form-select">
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>‚Üì</option>
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>‚Üë</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-secondary w-100">Apply</button>
        </div>
    </form>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
    <span class="results-count">
        Showing <strong>{{ articles|length }}</strong> article{% if articles|length != 1 %}s{% endif %}
        {% if filter_style or filter_podcast or search_query %}
        (filtered)
        <a href="{{ url_for('view_articles') }}" class="ms-2 text-decoration-none">Clear filters</a>
        {% endif %}
    </span>
</div>

{% if articles %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for article in articles %}
    <div class="col">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <span class="badge bg-primary">{{ article.style }}</span>
                    <small class="text-muted">üéôÔ∏è {{ article.podcast_title or 'Podcast' }}</small>
                </div>
                <h5 class="card-title">{{ article.topic }}</h5>
                <p class="card-text text-muted small">
                    Episode: <em>{{ article.episode_title[:40] }}{% if article.episode_title|length > 40 %}...{% endif %}</em>
                </p>
                <p class="card-text">
                    {{ article.content[:200] | striptags }}{% if article.content|length > 200 %}...{% endif %}
                </p>
            </div>
            <div class="card-footer bg-transparent">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">{{ article.created_at[:10] if article.created_at else '' }}</small>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('view_article', article_id=article.id) }}" class="btn btn-outline-primary">Read</a>
                        <a href="{{ url_for('edit_article', article_id=article.id) }}" class="btn btn-outline-secondary">Edit</a>
                        <form method="post" action="{{ url_for('remove_article', article_id=article.id) }}" class="d-inline"
                              onsubmit="return confirm('Delete this article?');">
                            <button type="submit" class="btn btn-outline-danger" style="border-top-left-radius: 0; border-bottom-left-radius: 0;">√ó</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <div class="display-1 mb-3">‚úçÔ∏è</div>
    <h3>No Articles Found</h3>
    {% if filter_style or filter_podcast or search_query %}
    <p class="text-muted">No articles match your current filters.</p>
    {% else %}
    <p class="text-muted">Generate your first article by processing a podcast episode and using the article generator.</p>
    <a href="{{ url_for('index') }}" class="btn btn-primary">Browse Feeds</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
